# log-linter

–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è Go

---

## –û–ø–∏—Å–∞–Ω–∏–µ

`log-linter` ‚Äî —ç—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –±–∞–∑–µ `golang.org/x/tools/go/analysis`, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏–π –≤ Go-–∫–æ–¥–µ.

–õ–∏–Ω—Ç–µ—Ä —Å–æ–≤–º–µ—Å—Ç–∏–º —Å `golangci-lint` –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:

* –∫–∞–∫ standalone-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
* –∫–∞–∫ –ø–ª–∞–≥–∏–Ω –¥–ª—è golangci-lint
* –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–µ

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ—Å—Ç–æ–≤—ã–º –∑–∞–¥–∞–Ω–∏–µ–º –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é ¬´Backend-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞. Golang¬ª.

---

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ª–æ–≥–≥–µ—Ä—ã

–í —Ä–∞–º–∫–∞—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:

* `log/slog`
* `go.uber.org/zap`

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ type-check (`pass.TypesInfo`) —Å fallback-–º–µ—Ö–∞–Ω–∏–∑–º–æ–º –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞

–õ–∏–Ω—Ç–µ—Ä –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –≤ –º–µ—Ç–æ–¥—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`Info`, `Error`, `Warn`, `Debug` –∏ –¥—Ä.).

### 1. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å–æ —Å—Ç—Ä–æ—á–Ω–æ–π –±—É–∫–≤—ã

‚ùå –ù–µ–≤–µ—Ä–Ω–æ:

```go
slog.Info("Starting server")
```

‚úÖ –í–µ—Ä–Ω–æ:

```go
slog.Info("starting server")
```

–î–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω `SuggestedFix`.

---

### 2. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ

–ó–∞–ø—Ä–µ—â–µ–Ω—ã —Å–∏–º–≤–æ–ª—ã –≤–Ω–µ ASCII-–¥–∏–∞–ø–∞–∑–æ–Ω–∞.

‚ùå –ù–µ–≤–µ—Ä–Ω–æ:

```go
slog.Info("–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞")
```

---

### 3. –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –∏–ª–∏ —ç–º–æ–¥–∑–∏

–ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è.

‚ùå –ù–µ–≤–µ—Ä–Ω–æ:

```go
slog.Info("server started!!!")
slog.Info("server started üöÄ")
```

---

### 4. –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ:

* –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
* —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º

‚ùå –ù–µ–≤–µ—Ä–Ω–æ:

```go
logger.Info("api_key=123")
logger.Info("user password: " + password)
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
internal/analyzer   ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
plugin              ‚Äî –ø–ª–∞–≥–∏–Ω –¥–ª—è golangci-lint
cmd/log-linter      ‚Äî standalone —Ä–µ–∂–∏–º
testdata            ‚Äî —Ç–µ—Å—Ç—ã (diagnostics + golden SuggestedFix)
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `analysistest`:

* unit-—Ç–µ—Å—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
* golden-—Ç–µ—Å—Ç—ã –¥–ª—è SuggestedFix
* –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã:

  * `a` ‚Äî –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (slog)
  * `b` ‚Äî SuggestedFix
  * `c` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ zap
  * `go.uber.org/zap` ‚Äî stub-–ø–∞–∫–µ—Ç

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
go test ./...
```

–¢–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `TestMain`.

---

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞, —Å–±–æ—Ä–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

---

# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Go **1.22+**
* golangci-lint v2.x
* CGO (–¥–ª—è —Å–±–æ—Ä–∫–∏ plugin)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å toolchain:

```bash
export GOTOOLCHAIN=local
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥–º–µ–Ω—É –≤–µ—Ä—Å–∏–∏ Go (–≤–∞–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–ª–∞–≥–∏–Ω–æ–≤).

---

# Standalone —Ä–µ–∂–∏–º

–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é.

## –°–±–æ—Ä–∫–∞

```bash
go build -o log-linter ./cmd/log-linter
```

## –ó–∞–ø—É—Å–∫

```bash
./log-linter ./...
```

---

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å golangci-lint 

## –°–±–æ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

```bash
CGO_ENABLED=1 go build -buildmode=plugin -o loglinter.so ./plugin
```

---

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ `.golangci.yml`

```yaml
version: "2"

linters:
  enable:
    - loglinter

  settings:
    custom:
      loglinter:
        path: ./loglinter.so
        description: "Checks log message formatting and sensitive data"
        original-url: "https://github.com/RomaNano/log-linter"
        settings:
          allow-symbols: false
          sensitive: "password,token,secret"
          sensitive-patterns:
            - api_key
          sensitive-regex:
            - '(?i)\bapi[-_]?key\b\s*=\s*\S+'
```

## –ó–∞–ø—É—Å–∫

```bash
golangci-lint run -E loglinter
```

---

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª (–ë–æ–Ω—É—Å)

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π YAML-–∫–æ–Ω—Ñ–∏–≥.

## –ü—Ä–∏–º–µ—Ä `loglinter.yml`

```yaml
allow_symbols: false

sensitive:
  - password
  - token
  - api_key

sensitive_regex:
  - '(?i)\bapi[-_]?key\b\s*=\s*\S+'
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
export LOGLINTER_CONFIG=./loglinter.yml
golangci-lint run -E loglinter
```

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫:

```
default < golangci-lint settings < LOGLINTER_CONFIG
```

–ï—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ª–∏–Ω—Ç–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É.

---

# Auto-Fix (SuggestedFix)

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª–∞:

* –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –±—É–∫–≤—ã —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ—á–Ω—É—é

–ü—Ä–∏–º–µ—Ä:

```go
slog.Info("Starting server")
```

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è fix:

```go
slog.Info("starting server")
```

SuggestedFix –ø–æ–∫—Ä—ã—Ç golden-—Ç–µ—Å—Ç–∞–º–∏.

---

# CI/CD

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏–º–µ—Ä GitHub Actions workflow, –∫–æ—Ç–æ—Ä—ã–π:

1. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã:

```bash
go test ./...
```

2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–±–æ—Ä–∫—É –ø–ª–∞–≥–∏–Ω–∞:

```bash
CGO_ENABLED=1 go build -buildmode=plugin -o loglinter.so ./plugin
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å plugin.

---

# –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Go plugins

Go plugins —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ –≤–µ—Ä—Å–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞.

–ü–ª–∞–≥–∏–Ω –∏ `golangci-lint` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã –æ–¥–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π Go.

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π:

```bash
go version
golangci-lint version
```

–ü—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞:

```
plugin was built with a different version of package internal/goarch
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```bash
export GOTOOLCHAIN=local
```

---

# –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç:

* –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤
* –ø–æ–¥–¥–µ—Ä–∂–∫—É `log/slog` –∏ `go.uber.org/zap`
* –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å `golangci-lint`
* –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Ñ–∞–π–ª
* SuggestedFix
* unit-—Ç–µ—Å—Ç—ã –∏ golden-—Ç–µ—Å—Ç—ã
* CI-–ø–∞–π–ø–ª–∞–π–Ω

